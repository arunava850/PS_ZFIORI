sap.ui.define(["com/public/storage/paoro/utils/reusecontroller","sap/m/BusyDialog","sap/m/MessageToast","sap/ui/core/Fragment","com/public/storage/paoro/utils/formatter","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","s+
ap/ui/model/FilterType"],function(e,t,o,r,i,l,s,n,a){"use strict";var u;return e.extend("com.public.storage.paoro.controller.PropertyStructure",{formatter:i,onInit:function(){u=this;const e=this.getRouter();e.getRoute("propStructure").attachMatched(this.+
_onRouteMatched,this);this._oBusyDialog=new t;this.getView().addDependent(this._oBusyDialog)},_onRouteMatched:function(e){const t=this.getRouter();this.getOwnerComponent.hasChanges=false;const o=this.getOwnerComponent().plant;if(o===undefined){return t.n+
avTo("home")}const r=this.getOwnerComponent().LegacyPropertyNumber;this._oModel=sap.ui.getCore().getModel("mainModel");this.readPropertyData(o,r);this.readOrgStructure();this.readHierarachy();if(this.getView().getModel("treeModel")){this.getView().getMod+
el("treeModel").setData([])}},buildTree:function(e){var t={};e.forEach(function(e){if(e.__metadata){delete e.__metadata}if(!t[e.LevelId]){t[e.LevelId]=e;t[e.LevelId].children=[]}else{t[e.LevelId]=Object.assign(t[e.LevelId],e)}var o=parseInt(e.LevelId)-1;+
if(o>=0){if(!t[o].children){t[o].children=[]}t[o].children.push(t[e.LevelId])}});var o=Object.values(t).filter(function(e){return parseInt(e.LevelId)===0});return o},onCollapseAll:function(e){const t=this.byId("treeTable");const o=e.getSource().getState(+
);if(o){t.expandToLevel(10)}else{t.collapseAll()}},_onValueHelpOrgStruc:function(e){const t=this;const o=this.getView();if(!this._pValueHelpFieldSup){this._pValueHelpFieldSup=r.load({id:o.getId(),name:"com.public.storage.paoro.fragments.PropertyStructure+
.OrgStructure",controller:this}).then(function(e){o.addDependent(e);return e})}this._oBusyDialog.open();this._pValueHelpFieldSup.then(function(e){t._oBusyDialog.close();e.open()})},_onValueHelpHier:function(){const e=this;const t=this.getView();if(!this.+
_pValueHelpSupOff){this._pValueHelpSupOff=r.load({id:t.getId(),name:"com.public.storage.paoro.fragments.PropertyStructure.Hierarchy",controller:this}).then(function(e){t.addDependent(e);return e})}this._oBusyDialog.open();this._pValueHelpSupOff.then(func+
tion(t){e._oBusyDialog.close();t.open()})},onValueHelpDialogClose:function(e){var t=e.getParameter("selectedItem");let o=e.getSource().getTitle();if(!t){return}if(o==="Org Structure"){let e=t.getDescription();this._sCodeOrg=t.getTitle();this.getView().ge+
tModel("plantBasicDetailsModel").setProperty("/OrgStruct",`(${this._sCodeOrg}) ${e}`);this.byId("hier").setEnabled(true);this.byId("hier").setValue("")}if(o==="Hierarchy Code"){let e=t.getDescription();let o=t.getTitle();this.getView().getModel("plantBas+
icDetailsModel").setProperty("/HierCode",`(${o}) ${e}`);this.callTreeService(o,this._sCodeOrg)}},onValueHelpDialogSearchHierStruct:function(e){let t=e.getParameter("value");let o=new s("Description",n.Contains,t);e.getSource().getBinding("items").filter(+
[o])},onValueHelpDialogSearchOrgStruct:function(e){let t=e.getParameter("value");let o=new s("Description",n.Contains,t);e.getSource().getBinding("items").filter([o])},callTreeService:function(e,t){const r=this;let i=new sap.ui.model.Filter("LegacyProper+
tyNumber","EQ",this.getOwnerComponent().LegacyPropertyNumber);let s=new sap.ui.model.Filter("OrgStruct","EQ",t);let n=new sap.ui.model.Filter("HierCode","EQ",e);this._oBusyDialog.open();this._oModel.read(`/PropertyHierarchySet`,{filters:[i,s,n],success:f+
unction(e){r._oBusyDialog.close();r.byId("treeTable").setVisible(true);const t=r.buildTree(e.results);const i=new l(t[0]);r.getView().setModel(i,"treeModel");r.getView().getModel("treeModel").refresh();if(!t.length){return o.show("No Data Found")}r.byId(+
"treeTable").expandToLevel(10)},error:function(e){r._oBusyDialog.close();r.byId("treeTable").setVisible(false);if(e.responseText){const t=JSON.parse(e.responseText).error.message.value;if(t.includes("Cost Center Group")){o.show(t);r.getView().getModel("t+
reeModel").setData([])}else{o.show("No Date Found");r.getView().getModel().setData([])}}else{o.show("Something went wrong with the service");r.getView().getModel().setData([])}}})}})});                                                                      
//# sourceMappingURL=PropertyStructure.controller.js.map                                                                                                                                                                                                       