sap.ui.define(["com/public/storage/paoro/utils/reusecontroller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/m/MessageToast","sap/m/MessageBox","sap/m/BusyDialog",+
"com/public/storage/paoro/utils/formatter"],function(e,t,o,n,r,a,s,i,l,g){"use strict";var c;let p=null;let d=false;return e.extend("com.public.storage.paoro.controller.Main",{formatter:g,onInit:function(){c=this;this.getOwnerComponent().plant="";const e+
=this;this._oModel=sap.ui.getCore().getModel("mainModel");const o=new t({visibliltyForThirdParty:false,visibilityForPTypeBlock:false,enabledForPlant:true,enabledForProperty:true,visForRetailPCBlock:true,visForStoragePCBlock:true,visForTennentPCBlock:true+
,visForManagementPCBlock:true,visForCommPCBlock:true});this.getView().setModel(o,"oVisModel");const n=this.getRouter();n.getRoute("home").attachMatched(this._onRouteMatched,this);this.BusyDialog=new l;this.readPropertyMasterData();this.getLoggedInUser()}+
,_onRouteMatched:function(e){const t=this.getOwnerComponent().plant;const o=this.getOwnerComponent().LegacyPropertyNumber;this._oModel=sap.ui.getCore().getModel("mainModel")},readPropertyMasterData:function(){const e=this;return new Promise(function(o,n)+
{e._oModel.read(`/PlantMasterSet`,{success:function(n){e.BusyDialog.close();const r=new t(n.results);r.setSizeLimit(n.results.length);e.getOwnerComponent().setModel(r,"plantsModel");sap.ui.getCore().setModel(r,"plantsModel");o(n.results)},error:function(+
e){s.show("Error fetching data from the service. Please try again.");n(e)}})})},getLoggedInUser:function(){const e=sap.ushell.Container.getService("UserInfo").getFullName();const o=new t({user:e});this.getView().setModel(o,"userModel")},_onValueHelpPlant+
:function(e){const t=this;var n=e.getSource().getValue(),r=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=o.load({id:r.getId(),name:"com.public.storage.paoro.fragments.Main.Plant",controller:this}).then(function(e){r.addDependent(e);re+
turn e})}this.BusyDialog.open();this._pValueHelpDialog.then(function(e){t.readPropertyMasterData().then(function(){t.BusyDialog.close();e.getBinding("items").getModel("plantsModel").getData().filter(e=>e.Name!=="");e.open()}).catch(function(e){t.BusyDial+
og.close()})})},_onValueHelpRequestProperty:function(e){const t=this;var n=e.getSource().getValue(),r=this.getView();if(!this._pValueHelpDialogProp){this._pValueHelpDialogProp=o.load({id:r.getId(),name:"com.public.storage.paoro.fragments.Main.Property",c+
ontroller:this}).then(function(e){r.addDependent(e);return e})}this.BusyDialog.open();this._pValueHelpDialogProp.then(function(e){t.readPropertyMasterData().then(function(){t.BusyDialog.close();e.getBinding("items").getModel("plantsModel").getData().filt+
er(e=>e.Name!=="");e.open()}).catch(function(e){t.BusyDialog.close()})})},onPlantSuggest:function(e){const t=e.getSource().getValue();const o=new n("Werks",r.Contains,t);e.getSource().getBinding("suggestionRows").filter(o)},onPropertySuggest:function(e){+
const t=e.getSource().getValue();const o=new n("Name2",r.Contains,t);e.getSource().getBinding("suggestionRows").filter(o)},_onValueHelpMarketClass:function(e){const t=this;var a=e.getSource().getValue(),s=this.getView();if(!this._pValueHelpDialogPropery)+
{this._pValueHelpDialogPropery=o.load({id:s.getId(),name:"com.public.storage.paoro.fragments.Main.Property",controller:this}).then(function(e){s.addDependent(e);return e})}this.BusyDialog.open();this._pValueHelpDialogPropery.then(function(e){t.readProper+
tyMasterData();t.BusyDialog.close();e.getBinding("items").filter([new n("Name",r.Contains,a)]);e.open(a)})},onSuggestionPropertySelected:function(e){this.getView().byId("propertyInput").setValue("");const t=this;var o=e.getParameter("selectedRow");const +
n=o.getBindingContext("plantsModel").getObject().Stras;const r=o.getBindingContext("plantsModel").getObject().Ort01;const a=o.getBindingContext("plantsModel").getObject().Land1;const s=o.getBindingContext("plantsModel").getObject().Name2Adrc;const l=o.ge+
tBindingContext("plantsModel").getObject().Name2;const g=o.getBindingContext("plantsModel").getObject().Regio;this.getView().byId("propertyInput").setValue(l);const c=o.getBindingContext("plantsModel").getObject().Pstlz;const p=`${s} ${n} ${r} ${g} ${c}`+
;const d=`${s} ${n} ${r} ${g} ${c}`;this.getOwnerComponent().plant=o.getBindingContext("plantsModel").getObject().Werks;const u=o.getBindingContext("plantsModel").getObject().Name2;if(this.getOwnerComponent().plant!==""){t.getOwnerComponent().getModel("p+
lantsModel").setProperty("/street",p);t.getOwnerComponent().getModel("plantsModel").setProperty("/address",d);t.getOwnerComponent().getModel("plantsModel").setProperty("/plant",this.getOwnerComponent().plant)}else{i.error(`Property Details does not exist+
 for the Property ${oText}`,{title:"Error",actions:[i.Action.OK],onClose:function(e){if(e===i.Action.OK){t.getView().getModel("oVisModel").setProperty("/visibilityForPTypeBlock",false)}else{}}})}},onSuggestionPlantSelected:function(e){this.getView().byId+
("propertyInput").setValue("");const t=this;var o=e.getParameter("selectedRow");const n=o.getBindingContext("plantsModel").getObject().Stras;const r=o.getBindingContext("plantsModel").getObject().Werks;const a=o.getBindingContext("plantsModel").getObject+
().Ort01;const s=o.getBindingContext("plantsModel").getObject().Land1;const l=o.getBindingContext("plantsModel").getObject().Name2Adrc;const g=o.getBindingContext("plantsModel").getObject().Regio;const c=o.getBindingContext("plantsModel").getObject().Pst+
lz;this.getView().byId("plantInput").setValue(r);const p=`${l}  ${n} ${a} ${g} ${c}`;const d=`${l} ${n} ${a} ${g} ${c}`;this.getOwnerComponent().plant=o.getBindingContext("plantsModel").getObject().Werks;const u=o.getBindingContext("plantsModel").getObje+
ct().Name2;if(u!==""){t.getOwnerComponent().getModel("plantsModel").setProperty("/street",p);t.getOwnerComponent().getModel("plantsModel").setProperty("/address",d);t.getOwnerComponent().getModel("plantsModel").setProperty("/property",u)}else{i.error(`Pr+
operty Details does not exist for the plant ${oText}`,{title:"Error",actions:[i.Action.OK],onClose:function(e){if(e===i.Action.OK){t.getView().getModel("oVisModel").setProperty("/visibilityForPTypeBlock",false)}else{}}})}},onCheckPropertyTable:async func+
tion(){const e=this;this.getOwnerComponent().LegacyPropertyNumber=this.getView().byId("propertyInput").getValue();if(this.getOwnerComponent().LegacyPropertyNumber===""||this.getOwnerComponent().plant===""){return s.show("Please fill the Plant/Property De+
tails")}var o=new sap.ui.model.Filter("Plant","EQ",this.getOwnerComponent().plant);var n=new sap.ui.model.Filter("LegacyPropertyNumber","EQ",this.getOwnerComponent().LegacyPropertyNumber);var r=new sap.ui.model.Filter([o,n],true);this.BusyDialog.open();r+
eturn new Promise(function(){e._oModel.read(`/PropertyMasterSet`,{filters:[r],and:false,success:function(o){e.BusyDialog.close();if(o.results.length){const n=new t(o.results);e.getView().setModel(n,"pResultModel");i.confirm(`Property Details for the prop+
erty ${e.getOwnerComponent().LegacyPropertyNumber} is available. Do you want to display?`,{title:"Confirmation",actions:[i.Action.YES,i.Action.CANCEL],emphasizedAction:i.Action.YES,onClose:function(t){if(t===i.Action.YES){e.getView().getModel("plantsMode+
l").setProperty("/property",e.getOwnerComponent().LegacyPropertyNumber);e.getView().getModel("oVisModel").setProperty("/visibilityForPTypeBlock",true);e.getView().getModel("oVisModel").setProperty("/visibliltyForOwner",true);e.getView().getModel("oVisMod+
el").setProperty("/enabledForPlant",false);e.getView().getModel("oVisModel").setProperty("/enabledForProperty",false);e.getView().byId("idReset").setEnabled(true);const t=e.getView().getModel("pResultModel").getData()[0].PropertyType;if(t==="O"){e.byId("+
rb1").setSelected(true)}if(t==="T"){e.byId("rb2").setSelected(true)}e.readProfitCenters()}else{}}})}else{i.error(`Property Details for the property ${e.getOwnerComponent().LegacyPropertyNumber} is not available.`)}},error:function(t){e.BusyDialog.close()+
;s.show("Something went wrong with Service")}})})},readProfitCenters:function(){const e=this;var o=new sap.ui.model.Filter("Plant","EQ",this.getOwnerComponent().plant);var n=new sap.ui.model.Filter("LegacyPropertyNumber","EQ",this.getOwnerComponent().Leg+
acyPropertyNumber);var r=new sap.ui.model.Filter([o,n],true);this._oModel.read(`/ProfitCenterSet`,{filters:[r],and:false,success:function(o){const n=new t(o.results);e.getView().setModel(n,"profitCenterModel");sap.ui.getCore().setModel(n,"profitCenterMod+
el");e.getView().getModel("profitCenterModel").refresh()},error:function(e){s.show("Something went wrong with Service")}})},onResetField:function(){this.getView().getModel("oVisModel").setProperty("/enabledForPlant",true);this.getView().getModel("oVisMod+
el").setProperty("/enabledForProperty",true);this.getView().getModel("oVisModel").setProperty("/visibilityForPTypeBlock",false);this.getView().getModel("oVisModel").setProperty("/visibliltyForThirdParty",false);this.byId("idReset").setEnabled(false);this+
.byId("rb1").setSelected(true);this.getOwnerComponent().plant="";this.getOwnerComponent().LegacyPropertyNumber="";this.byId("rbg1").setSelectedIndex(0);this.getView().byId("address").setText("");this.getView().byId("plantInput").setValue("");this.getView+
().byId("propertyInput").setValue("")},createNewProperty:function(){const e=this;const t=this.getOwnerComponent().plant;const o=this.getOwnerComponent().LegacyPropertyNumber;const n={Plant:t,LegacyPropertyNumber:o};const r=this.getView().getModel("plants+
Model").getData().filter(e=>e.Werks===n.Plant);if(r?.length){this.SavePCTableData()}else{this._oModel.create(`/PropertyMasterSet`,n,{success:function(){e.SavePCTableData()},error:function(e){s.show("Something went wrong with Service")}})}},onPressSave:fu+
nction(){this.BusyDialog.open();const e={};let t=[];var o=true;const n=this.byId("idPCTable").getModel("profitCenterModel");if(n){const r=n.getData();r.forEach(n=>{const r=n.Prctr.slice(-1);if(/\d/.test(r)){o=false;t.push(n)}else{}if(!e[r]){e[r]=[]}e[r].+
push(n)});if(e.R===undefined&&o===true){this.BusyDialog.close();return s.show("Missing Storage Profit Center")}else{this.createNewProperty()}}},SavePCTableData:function(){const e=this;let t;let o;const n={};let r=[];let a="T00:00:00";const i=this.getOwne+
rComponent().getModel("plantsModel").getData();const l=this.getOwnerComponent().getModel("plantsModel").getProperty("/plant");const g=i.filter(e=>e.Werks===l);const c=g[0].Ort01;const p=g[0].Land1;const d=g[0].Name2Adrc;const u=g[0].Name1;const y=g[0].Re+
gio;const m=g[0].Pstlz;const M=g[0].City2;const P=g[0].Stras;let f=this.byId("rb1").getSelected();if(f===true){o="O"}else{o="T"}const h=this.getOwnerComponent().plant;const C=this.getOwnerComponent().LegacyPropertyNumber;const w=this.byId("idPCTable").ge+
tModel("profitCenterModel");if(w){const i=w.getData();i.forEach(e=>{const t=e.Prctr.slice(-1);if(/\d/.test(t)){r.push(e)}else{}if(!n[t]){n[t]=[]}n[t].push(e)});if(n.R){var D=n.R[0].Prctr;var b=n.R[0].LongText;var v=n.R[0].Bukrs;var O=sap.ui.core.format.D+
ateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.R[0].Datab))+a;var S=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.R[0].Datbi))+a;var B=n.R[0].Segment;if(n.R.length>1){var V=n.R[1].Prctr;var x+
=n.R[1].LongText;var I=n.R[1].Bukrs;var F=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.R[0].Datab))+a;var T=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.R[0].Datbi))+a;+
var $=n.R[1].Segment}}if(r.length){var V=r[0].Prctr;var x=r[0].LongText;var I=r[0].Bukrs;var F=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(r[0].Datab))+a;var T=sap.ui.core.format.DateFormat.getDateInstance({patte+
rn:"yyyy-MM-dd"}).format(new Date(r[0].Datbi))+a;var $=r[0].Segment}if(n.T){var R=n.T[0].Prctr;var L=n.T[0].LongText;var N=n.T[0].Bukrs;var j=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.T[0].Datab))+a;var E=sap+
.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.T[0].Datbi))+a;var k=n.T[0].Segment}if(n.A){var A=n.A[0].Prctr;var _=n.A[0].LongText;var H=n.A[0].Bukrs;var W=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyy+
y-MM-dd"}).format(new Date(n.A[0].Datab))+a;var K=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.A[0].Datbi))+a;var z=n.A[0].Segment}if(n.E){var Q=n.E[0].Prctr;var U=n.E[0].LongText;var Y=n.E[0].Bukrs;var q=sap.ui+
.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.E[0].Datab))+a;var J=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.E[0].Datbi))+a;var G=n.E[0].Segment}if(n.M){var X=n.M[0].Prctr;+
var Z=n.M[0].LongText;var ee=n.M[0].Bukrs;var te=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.M[0].Datab))+a;var oe=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.M[0].Da+
tbi))+a;var ne=n.M[0].Segment}if(n.C){var re=n.C[0].Prctr;var ae=n.C[0].LongText;var se=n.C[0].Bukrs;var ie=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.C[0].Datab))+a;var le=sap.ui.core.format.DateFormat.getDat+
eInstance({pattern:"yyyy-MM-dd"}).format(new Date(n.C[0].Datbi))+a;var ge=n.C[0].Segment}t={RetailPc:A,RetailPcLtext:_,RetailPcCc:H,RetailPcFromDate:W,RetailPcToDate:K,RetailPcSegment:z,StoragePc:D,StoragePcLtext:b,StoragePcCc:v,StoragePcFromDate:O,Stora+
gePcToDate:S,StoragePcSegment:B,StorageCbtPc:V,StorageCbtPcLtext:x,StorageCbtPcCc:I,StorageCbtPcFromDate:F,StorageCbtPcToDate:T,StorageCbtPcSegment:$,CommercialPc:re,CommercialPcLtext:ae,CommercialPcCc:se,CommercialPcFromDate:ie,CommercialPcToDate:le,Com+
mercialPcSegment:ge,TennentInsPc:R,TennentInsPcLtext:L,TennentInsPcCc:N,TennentInsPcFromDate:j,TennentInsPcToDate:E,TennentInsPcSegment:k,ManagmentPc:X,ManagmentPcLtext:Z,ManagmentPcCc:ee,ManagmentPcFromDate:te,ManagmentPcToDate:oe,ManagmentPcSegment:ne,+
SolarEnergyPc:Q,SolarEnergyPcLtext:U,SolarEnergyPcCc:Y,SolarEnergyPcFromDate:q,SolarEnergyPcToDate:J,SolarEnergyPcSegment:G,City:c,Street:P,Description:d,MailingName:u,Country:p,County:M,PostalCode:m,State:y,PropertyType:o};const l=`/PropertyMasterSet(Pl+
ant='${h}',LegacyPropertyNumber='${C}')`;this._oModel.update(l,t,{success:function(t){e.BusyDialog.close();s.show("Saved Successfully")},error:function(t){e.BusyDialog.close();s.show("Something went wrong with Service")}})}},onValueHelpDialogClosePlant:f+
unction(e){const t=this;var o,n=e.getParameter("selectedItem");let r=n.getBindingContext("plantsModel").getObject().Werks;if(!n){return}o=r;this.getView().byId("plantInput").setValue(o);this.getView().byId("address").setText("");const a=n.getBindingConte+
xt("plantsModel").getObject().Stras;const s=n.getBindingContext("plantsModel").getObject().Ort01;const l=n.getBindingContext("plantsModel").getObject().Land1;const g=n.getBindingContext("plantsModel").getObject().Name2Adrc;const c=n.getBindingContext("pl+
antsModel").getObject().Name2;const p=n.getBindingContext("plantsModel").getObject().Regio;const d=n.getBindingContext("plantsModel").getObject().Pstlz;const u=`${g} ${a} ${s} ${p} ${d}`;const y=`${g} ${a} ${s} ${p} ${d}`;this.getOwnerComponent().plant=n+
.getBindingContext("plantsModel").getObject().Werks;const m=n.getBindingContext("plantsModel").getObject().Name2;if(m!==""){t.getOwnerComponent().getModel("plantsModel").setProperty("/street",u);t.getOwnerComponent().getModel("plantsModel").setProperty("+
/address",y);t.getOwnerComponent().getModel("plantsModel").setProperty("/property",m)}else{i.error(`Property Details does not exist for the plant ${o}`,{title:"Error",actions:[i.Action.OK],onClose:function(e){if(e===i.Action.OK){t.getView().getModel("oVi+
sModel").setProperty("/visibilityForPTypeBlock",false)}else{}}})}},onValueHelpDialogCloseProperty:function(e){const t=this;var o,n=e.getParameter("selectedItem");let r=n.getBindingContext("plantsModel").getObject().Name2;if(!n){return}o=r;this.getView().+
byId("propertyInput").setValue(o);this.getView().byId("address").setText("");const a=n.getBindingContext("plantsModel").getObject().Stras;const s=n.getBindingContext("plantsModel").getObject().Ort01;const l=n.getBindingContext("plantsModel").getObject().+
Land1;const g=n.getBindingContext("plantsModel").getObject().Name2Adrc;const c=n.getBindingContext("plantsModel").getObject().Name2;const p=n.getBindingContext("plantsModel").getObject().Regio;const d=n.getBindingContext("plantsModel").getObject().Pstlz;+
const u=`${g} ${a} ${s} ${p} ${d}`;const y=`${g} ${a} ${s} ${p} ${d}`;this.getOwnerComponent().plant=n.getBindingContext("plantsModel").getObject().Werks;const m=n.getBindingContext("plantsModel").getObject().Werks;if(m!==""){t.getOwnerComponent().getMod+
el("plantsModel").setProperty("/street",u);t.getOwnerComponent().getModel("plantsModel").setProperty("/address",y);t.getOwnerComponent().getModel("plantsModel").setProperty("/plant",m)}else{i.error(`Property Details does not exist for the Property ${o}`,+
{title:"Error",actions:[i.Action.OK],onClose:function(e){if(e===i.Action.OK){t.getView().getModel("oVisModel").setProperty("/visibilityForPTypeBlock",false)}else{}}})}},onValueHelpDialogSearchPlant:function(e){var t=e.getParameter("value");var o=new n("W+
erks",r.Contains,t);e.getSource().getBinding("items").filter([o])},onValueHelpDialogSearchPC:function(e){var t=e.getParameter("value");var o=new n("Prctr",r.Contains,t);e.getSource().getBinding("items").filter([o])},onValueHelpDialogSearchProperty:functi+
on(e){var t=e.getParameter("value");var o=new n("Name2",r.Contains,t);e.getSource().getBinding("items").filter([o])},onRefresPCs:function(){const e=this;var o=new sap.ui.model.Filter("Plant","EQ",this.getOwnerComponent().plant);var n=new sap.ui.model.Fil+
ter("LegacyPropertyNumber","EQ",this.getOwnerComponent().LegacyPropertyNumber);var r=new sap.ui.model.Filter("Action","EQ","REFRESH");var a=new sap.ui.model.Filter([o,n,r],true);this.BusyDialog.open();e._oModel.read(`/ProfitCenterSet`,{filters:[a],and:fa+
lse,success:function(o){e.BusyDialog.close();const n=new t(o.results);if(o.results.length){e.getView().setModel(n,"profitCenterModel");sap.ui.getCore().setModel(n,"profitCenterModel");e.getView().getModel("profitCenterModel").refresh()}const r=e.getOwner+
Component().plant.toUpperCase();const a=r.charAt(0);if(a>="A"&&a<="V"){e.byId("rb1").setSelected(true)}else{e.byId("rb2").setSelected(true)}},error:function(t){e.BusyDialog.close();s.show("Something went wrong with Service")}})}})});                      
//# sourceMappingURL=Main.controller.js.map                                                                                                                                                                                                                    